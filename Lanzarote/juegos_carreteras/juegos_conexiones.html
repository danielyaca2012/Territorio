<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Juego de conexiones â€“ Lanzarote</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
html,body{margin:0;font-family:Arial;background:#0b7;}
#top{padding:10px;background:#0a6;color:#042;display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
#contenedor{max-width:820px;margin:16px auto;padding:10px;}
.caja{background:white;border-radius:12px;padding:14px;margin-bottom:12px;box-shadow:0 4px 10px rgba(0,0,0,.12);}
.titulo{font-weight:700;font-size:1.1rem;margin-bottom:8px;}
.lista{display:flex;flex-wrap:wrap;gap:8px;}
.item{padding:6px 10px;border-radius:8px;background:#e6f7f3;cursor:pointer;}
.item.sel{box-shadow:inset 0 0 0 2px #0b7;background:#d1f0e6;}
.item.ok{background:#c8f7c5;}
.item.bad{background:#f7c5c5;}
.item.miss{background:#eee;color:#666;}
.drag{cursor:grab;}
button{padding:8px 12px;border-radius:8px;border:none;background:#0b7;color:white;cursor:pointer;}
button:hover{background:#099;}
#map{height:320px;border-radius:10px;}
.controles{display:flex;gap:10px;justify-content:center;}

#estadisticas{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);
  background:rgba(0,0,0,.8);
  color:white;padding:30px 40px;
  border-radius:14px;display:none;z-index:2000;
  text-align:center;
}

#buscador{
  display:none;
}
</style>
</head>

<body>

<div id="top">
  <button id="btnIniciar">ğŸ“ Iniciar examen</button>
  <button id="btnRepaso">ğŸ“– Modo repaso</button>

  <input id="buscador" placeholder="Buscar carretera (LZ-2, LZ-30...)">

  <label><input type="checkbox" id="chkPrim" checked> Primarias</label>
  <label><input type="checkbox" id="chkSec" checked> Secundarias</label>
  <label><input type="checkbox" id="chkTer" checked> Terciarias</label>

  <strong>Correctas: <span id="correctas">0</span></strong>
  <strong>Fallos: <span id="fallos">0</span></strong>

  <button style="margin-left:auto" onclick="volver()">â¬… Volver</button>
</div>

<div id="contenedor">
  <div class="caja">
    <div id="tituloFicha" class="titulo">â€”</div>
    <div id="descFicha"></div>
  </div>

  <div class="caja">
    <strong>ğŸ“ Municipios</strong>
    <div id="municipios" class="lista"></div>
  </div>

  <div class="caja">
    <strong>ğŸ˜ï¸ Pasa por</strong>
    <div id="pasaPor" class="lista"></div>
  </div>

  <div class="caja">
    â–¶ Inicio: <span id="inicio">â€”</span><br>
    â¹ Final: <span id="final">â€”</span>
  </div>

  <div class="caja"><div id="map"></div></div>

  <div class="controles">
    <button id="btnCorregir">âœ” Corregir</button>
    <button id="btnSiguiente">Siguiente â¡</button>
  </div>
</div>

<div id="estadisticas"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="data_carreteras.js"></script>

<script>
const map=L.map("map").setView([28.96,-13.60],11);
L.tileLayer("https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png").addTo(map);

let geoData, baseLayer, activeLayer;
let modoRepaso=true;
let corregida=false;

fetch("carreteras_lanzarote_fin.geojson")
.then(r=>r.json())
.then(j=>{
  geoData=j;
  baseLayer=L.geoJSON(geoData,{
    style:{color:"#3388ff",weight:4},
    onEachFeature:(f,l)=>{
      l.on("click",()=>{
        if(modoRepaso) mostrarFicha(f.properties.ref);
      });
    }
  }).addTo(map);
});

function highlight(ref,color){
  if(activeLayer) map.removeLayer(activeLayer);
  activeLayer=L.geoJSON(geoData,{
    filter:f=>f.properties.ref===ref,
    style:{color,weight:6}
  }).addTo(map);
  map.fitBounds(activeLayer.getBounds(),{padding:[20,20]});
}

function mostrarFicha(ref){
  const f=dataCarreteras[ref];
  if(!f)return;
  tituloFicha.textContent=ref;
  descFicha.textContent=f.descripcion||"";
  inicio.textContent=f.inicio||"â€”";
  final.textContent=f.final||"â€”";
  municipios.innerHTML=f.municipios.map(m=>`<div class="item">${m}</div>`).join("");
  pasaPor.innerHTML=f.pasaPor.map(p=>`<div class="item">${p}</div>`).join("");
  highlight(ref,"orange");
}

btnRepaso.onclick=()=>{
  modoRepaso=true;
  corregida=false;
  estadisticas.style.display="none";
  document.getElementById("buscador").style.display="inline";
};

btnIniciar.onclick=()=>{
  modoRepaso=false;
  corregida=false;
  estadisticas.style.display="none";
  document.getElementById("buscador").style.display="none";
  iniciarExamen();
};

btnCorregir.onclick=()=>{
  if(modoRepaso) return;
  corregida=true;
  alert("CorrecciÃ³n aplicada (simulada aquÃ­)");
};

btnSiguiente.onclick=()=>{
  if(modoRepaso) return;
  if(!corregida){
    alert("Debes corregir la pregunta antes de continuar");
    return;
  }
  corregida=false;
  alert("Siguiente pregunta (simulada)");
};

document.getElementById("buscador").oninput=e=>{
  const v=e.target.value.toUpperCase();
  const ref=Object.keys(dataCarreteras).find(r=>r.includes(v));
  if(ref) mostrarFicha(ref);
};

function iniciarExamen(){ /* lÃ³gica real ya la tienes */ }

function volver(){location.href="/Territorio/index.html";}
</script>

</body>
</html>
