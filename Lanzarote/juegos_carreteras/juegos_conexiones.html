<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Juego de conexiones de carreteras ‚Äì Lanzarote</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
html, body {
  margin: 0;
  height: 100%;
  font-family: Arial, Helvetica, sans-serif;
  background: linear-gradient(135deg, #0b7, #0a5);
}

#top {
  padding: 10px;
  background: #0b7;
  color: #042;
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap;
}

#contenedor {
  max-width: 720px;
  margin: auto;
  padding: 15px;
}

.caja {
  background: white;
  border-radius: 12px;
  padding: 15px;
  margin-bottom: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}

textarea {
  width: 100%;
  min-height: 60px;
}

button {
  padding: 8px 14px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  background: #0b7;
  color: white;
  font-size: 1rem;
}

button:hover {
  background: #099;
}

#map {
  height: 260px;
  border-radius: 12px;
  overflow: hidden;
}

.resultado {
  margin-top: 5px;
  font-weight: bold;
}

.correcto { color: green; }
.incorrecto { color: red; }

.controles {
  display: flex;
  gap: 10px;
  justify-content: center;
}
</style>
</head>

<body>

<div id="top">
  <button onclick="iniciarExamen()">üìù Modo examen</button>
  <button onclick="activarRepaso()">üëÄ Modo repaso</button>

  <label><input type="checkbox" id="chkPrimarias" checked> Primarias</label>
  <label><input type="checkbox" id="chkSecundarias" checked> Secundarias</label>
  <label><input type="checkbox" id="chkTerciarias" checked> Terciarias</label>

  <button style="margin-left:auto" onclick="volver()">‚¨Ö Volver</button>
</div>

<div id="contenedor">

  <div class="caja">
    <h2 id="titulo">‚Äî</h2>
    <p id="descripcion"></p>
  </div>

  <div class="caja">
    üìç <strong>Municipios</strong>
    <textarea id="municipios"></textarea>
    <div id="resMunicipios" class="resultado"></div>
  </div>

  <div class="caja">
    üèòÔ∏è <strong>Pasa por</strong>
    <textarea id="pasaPor"></textarea>
    <div id="resPasaPor" class="resultado"></div>
  </div>

  <div class="caja">
    ‚ñ∂ <strong>Inicio:</strong> <span id="inicio"></span><br>
    ‚èπ <strong>Final:</strong> <span id="final"></span>
  </div>

  <div class="caja">
    <div id="map"></div>
  </div>

  <div class="controles">
    <button onclick="corregir()">‚úî Corregir</button>
    <button onclick="mostrarSolucion()">üëÅ Mostrar soluci√≥n</button>
    <button onclick="anterior()">‚¨Ö Anterior</button>
    <button onclick="siguiente()">Siguiente ‚û°</button>
  </div>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="data_carreteras.js"></script>

<script>
/* ================= MAPA ================= */
const map = L.map("map").setView([28.96, -13.60], 11);

L.tileLayer(
  "https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png"
).addTo(map);

let capaBase, capaActiva;

/* ================= DATOS ================= */
const claves = Object.keys(dataCarreteras);
let indice = 0;
let modoRepaso = false;

/* ================= CARGAR GEOJSON ================= */
fetch("carreteras_lanzarote_fin.geojson")
  .then(r => r.json())
  .then(data => {
    capaBase = data;
    mostrar();
  });

function tipoCarretera(ref){
  const n = parseInt(ref.replace("LZ-",""));
  if([1,2,3].includes(n)) return "primaria";
  if(n >= 10 && n <= 67) return "secundaria";
  return "terciaria";
}

/* ================= MOSTRAR ================= */
function mostrar(){
  const c = dataCarreteras[claves[indice]];

  document.getElementById("titulo").textContent = c.nombre;
  document.getElementById("descripcion").textContent = c.descripcion;
  document.getElementById("inicio").textContent = c.inicio;
  document.getElementById("final").textContent = c.final;

  if(!modoRepaso){
    municipios.value = "";
    pasaPor.value = "";
  }

  resMunicipios.textContent = "";
  resPasaPor.textContent = "";

  dibujarCarretera(c.nombre);
}

function dibujarCarretera(ref){
  if(capaActiva) map.removeLayer(capaActiva);

  capaActiva = L.geoJSON(capaBase, {
    filter: f => f.properties.ref === ref,
    style: { color:"red", weight:6 }
  }).addTo(map);

  map.fitBounds(capaActiva.getBounds(), { padding:[20,20] });
}

/* ================= JUEGO ================= */
function normalizar(t){
  return t.toLowerCase().trim();
}

function corregir(){
  const c = dataCarreteras[claves[indice]];

  const munUser = municipios.value.split(",").map(normalizar);
  const munOk = c.municipios.map(normalizar);

  const pasaUser = pasaPor.value.split(",").map(normalizar);
  const pasaOk = c.pasaPor.map(normalizar);

  evaluar(munUser, munOk, resMunicipios);
  evaluar(pasaUser, pasaOk, resPasaPor);
}

function evaluar(user, ok, cont){
  let aciertos = user.filter(v => ok.includes(v)).length;
  cont.textContent = `‚úî ${aciertos} / ${ok.length}`;
  cont.className = "resultado " + (aciertos === ok.length ? "correcto":"incorrecto");
}

function mostrarSolucion(){
  const c = dataCarreteras[claves[indice]];
  municipios.value = c.municipios.join(", ");
  pasaPor.value = c.pasaPor.join(", ");
}

/* ================= NAVEGACI√ìN ================= */
function siguiente(){
  indice = (indice + 1) % claves.length;
  mostrar();
}
function anterior(){
  indice = (indice - 1 + claves.length) % claves.length;
  mostrar();
}

/* ================= MODOS ================= */
function iniciarExamen(){
  modoRepaso = false;
  mostrar();
}
function activarRepaso(){
  modoRepaso = true;
  mostrarSolucion();
}

/* ================= UTIL ================= */
function volver(){
  location.href = "/Territorio/index.html";
}
</script>

</body>
</html>
